<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/bootstrap.min.css">

    <title>467 Camera Portal</title>
</head>
<body>
    <button id="connect" class="btn btn-primary" type="button" disabled>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        Loading...
    </button>

    <button class="btn btn-primary" type="button"> Launch Front </button>
    <button class="btn btn-danger" type="button"> Close Front </button>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/adapter.js"></script>
    <script type="text/javascript" src="js/janus.js"></script>

    <script>
        Janus.init({
            debug: true,
            dependencies: Janus.useDefaultDependencies(), // or: Janus.useOldDependencies() to get the behaviour of previous Janus versions
            callback: function() {
                
            }
        });

        let janus = new Janus(
            {
                // server: ["https://" + window.location.hostname + ":8089/janus", "http://" + window.location.hostname + ":8088/janus", "https://drivercamera.local:8089/janus", "http://drivercamera.local:8088/janus"],
                server: ["http://drivercamera.local:8088/janus", "https://" + window.location.hostname + ":8089/janus", "http://" + window.location.hostname + ":8088/janus", "https://drivercamera.local:8089/janus", "http://drivercamera.local:8088/janus"],
                success: function() {
                    janus.attach(
                        {
                            plugin: "janus.plugin.streaming",
                            success: function(pluginHandle) {
                                // Plugin attached! 'pluginHandle' is our handle
                                console.log("aaaa");
                                let streaming = pluginHandle;
                                let body1 = { request: "list" };
                                streaming.send({ message: body1, success: function(result) {
                                        console.log(result);
                                }});

                                let body2 = {
                                    "request" : "watch",
                                    "id" : 123,
                                    "pin" : "a"}
                                streaming.send({ message: body2, success: function(result) {
                                        console.log(result);
                                    }});
                            },
                            error: function(cause) {
                                // Couldn't attach to the plugin
                            },
                            consentDialog: function(on) {
                                // e.g., Darken the screen if on=true (getUserMedia incoming), restore it otherwise
                            },
                            onmessage: function(msg, jsep) {
                                // We got a message/event (msg) from the plugin
                                // If jsep is not null, this involves a WebRTC negotiation
                            },
                            onlocaltrack: function(track, added) {
                                // A local track to display has just been added (getUserMedia worked!) or removed
                            },
                            onremotetrack: function(track, mid, added) {
                                // A remote track (working PeerConnection!) with a specific mid has just been added or removed
                            },
                            oncleanup: function() {
                                // PeerConnection with the plugin closed, clean the UI
                                // The plugin handle is still valid so we can create a new one
                            },
                            detached: function() {
                                // Connection with the plugin closed, get rid of its features
                                // The plugin handle is not valid anymore
                            }
                        });
                },
                error: function(cause) {
                    // Error, can't go on...
                },
                destroyed: function() {
                    // I should get rid of this
                }
            });


    </script>

</body>
</html>